# Cookiecutter For o²S²PARC CLI Services 

Template library to generate an [o²S²PARC compatible computational service](https://docs.osparc.io/#/docs/platform_introduction/services?id=services) that installs and executes command-line tools.
For more general use-cases, with standardized definitions of inputs/outputs, please take a look at [cookiecutter-osparc-service](https://github.com/ITISFoundation/cookiecutter-osparc-service). 

## Requirements
- GNU Make
- Python3
- Python3-venv (recommended to work in a virtual environment)
- [``cookiecutter``](https://python-package-generator.readthedocs.io/en/master/)
- [``Docker``](https://docs.docker.com/get-docker/) (if you wish to build and test the service locally)

To install the cookiecutter:
```console
sudo apt-get update
sudo apt-get install -y make python3-venv
python3 -m venv .venv
source .venv/bin/activate
pip install cookiecutter jinja2_time
```

## Usage

Generate a new Service based on the cookiecutter template layout:
```console
python3 -m venv .venv
source .venv/bin/activate
cookiecutter git+ssh://git@github.com/ITISFoundation/cookiecutter-osparc-cli-service
```

## Information for the developers of this cookiecutter

### Run the tests
This will create a simple project, based on [cookiecutter.json](/cookiecutter.json), will build the images (this can take some time) and run a command in the container:
```console
make tests
```

## License

This project is licensed under the terms of the [MIT License](/LICENSE)

## More Details
The service code is in the folder [{{cookiecutter.project_slug}}](./{{cookiecutter.project_slug}}/). Users find instructions on how to create the service in the [README]({{cookiecutter.project_slug}}/README.md)

### How does this work
In most use-cases, users only need to install the desired tool in the [Dockerfile](./{{cookiecutter.project_slug}}/docker/Dockerfile)

The [input and outputs](./{{cookiecutter.project_slug}}/.osparc/metadata.yml}) of the service are already defined (users are not required to modify them).
The first input is a string for executing the required command and the second input is one file or more files (in a zip). The input file(s) are optional.

The script [service.cli/execute.sh](./{{cookiecutter.project_slug}}/service.cli/execute.sh) takes care of all the logic:
- retrieves inputs and copies them to the working directory
- executes the command
- retrieves the outputs: all the new files generated by the execution are copied and zipped in the output folder. If no output file is generated, the execution will terminate with an error.

### Example use-cases
The cookiecutter has been tested to create Services with the following tools:
- The bash `touch` command (also used in the tests)
- Spinal Cord Toolbox, e.g. command: `sct_deepseg_sc -i t1w.nii.gz -c t2`, we also have a [GUI-based service on o²S²PARC](https://github.com/ITISFoundation/spinal-cord-toolbox)
- k-wave, e.g. command: `kspaceFirstOrder-OMP -i input.h5 -o output.h5`, we also have a [computational service on o²S²PARC](https://github.com/ITISFoundation/k-wave)

---

<p align="center">
<a href="https://www.z43.swiss" target="_blank">
<image src="https://raw.githubusercontent.com/ITISFoundation/osparc-simcore-clients/4e8b18494f3191d55f6692a6a605818aeeb83f95/docs/_media/mwl.png" alt="Made with love (and lots of hard work) at www.z43.swiss" width="20%" />
</a>
</p>